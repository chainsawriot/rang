## generated by gran, do not edit by hand

.install_from_cran <- function(x, lib, path = tempdir()) {
    url <- paste0("https://cran.r-project.org/src/contrib/Archive/", names(x), "/", names(x), "_", x, ".tar.gz")
    tarball_path <- file.path(path, paste0(names(x), "_", x, ".tar.gz"))
    tryCatch({
        suppressWarnings(download.file(url, destfile = tarball_path))
    }, error = function(e) {
        ## is the current latest
        url <- paste0("https://cran.r-project.org/src/contrib/", names(x), "_", x, ".tar.gz")
        download.file(url, destfile = tarball_path)        
    })
    install.packages(pkg = tarball_path, lib = lib, repos = NULL)
    ## check and error
    if (!missing(lib)) {
        installed_packages <- installed.packages(lib.loc = lib)
    } else {
        installed_packages <- installed.packages()
    }
    if (!names(x) %in% dimnames(installed_packages)[[1]]) {
        stop("Fail to install ", names(x), "\n")
    }
    invisible()
}

